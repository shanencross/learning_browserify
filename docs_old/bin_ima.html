<!DOCTYPE html>

<html>
<head>
  <title>bin_ima.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>bin_ima.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Executing bin_ima.js"</span>);
<span class="hljs-keyword">var</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mathjs"</span>);
<span class="hljs-keyword">var</span> cpoly = <span class="hljs-built_in">require</span>(<span class="hljs-string">"poly-roots"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bin_ima</span>(<span class="hljs-params">GM1=<span class="hljs-number">0.5</span>, GM2=<span class="hljs-number">0.5</span>, D=<span class="hljs-number">0.5</span>, XS=<span class="hljs-number">0</span>, YS=<span class="hljs-number">0</span>, timeDebug=false</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>console.log(“Executing bin_ima function”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (timeDebug === <span class="hljs-literal">true</span>)
    <span class="hljs-built_in">console</span>.time();</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>GM1 = mass of object 1 (as a % of total mass) e.g. 0.1
GM2 = mass of object 2 (as a % of total mass) e.g  0.9
D = half binary separation (between components) in Einstein radii
XS, YS = x,y coordinates of the source (in x/R_E, y/R_E)
var scope = {GM1: GM1, GM2: GM2, D: D, XS: XS, YS: YS,};</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>XI, YI, AI = image coordinates (x,y) and magnification for
each of the five (max) images</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Complex coefficients ZC of the 5th order polynomial</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">6</span>).fill(<span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Image positions, complex notation
ZIC = new Array(5).fill(0);
Image parity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> IP = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">5</span>).fill(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">var</span> EP = <span class="hljs-number">1e-02</span>; <span class="hljs-comment">// 1e-03</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Set up parameters for the calculation of the coefficients</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>console.time();
HSM = math.eval(“(GM1 + GM2)/2.0”, scope);    // half sum of masses
HDM = math.eval(“(GM2 - GM1)/2.0”, scope);     // half difference of masses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> HSM = math.multiply(math.add(GM1, GM2), <span class="hljs-number">1</span>/<span class="hljs-number">2.0</span>);
  <span class="hljs-keyword">var</span> HDM = math.multiply(math.subtract(GM2, GM1), <span class="hljs-number">1</span>/<span class="hljs-number">2.0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>console.timeEnd();</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>HSM = 1.5;
HDM = 0.5;     // half difference of masses</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>console.time();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> HSDM = math.multiply(HSM, HDM);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>console.timeEnd();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> HSSM = math.multiply(HSM, HSM);
  <span class="hljs-keyword">var</span> HDDM = math.multiply(HDM, HDM);
  <span class="hljs-keyword">var</span> Z1 = math.complex(math.multiply(<span class="hljs-number">-1</span>,D), <span class="hljs-number">0.0</span>);
  <span class="hljs-keyword">var</span> Z2 = math.complex(D, <span class="hljs-number">0.0</span>);
  <span class="hljs-keyword">var</span> Z1C = math.complex(math.multiply(<span class="hljs-number">-1</span>, D), <span class="hljs-number">0.0</span>);
  <span class="hljs-keyword">var</span> Z2C = math.complex(D, <span class="hljs-number">0.0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Source location in complex notation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZS = math.complex(XS, YS);
  <span class="hljs-keyword">var</span> AS = math.abs(ZS);
  <span class="hljs-keyword">var</span> ZSC = math.complex(XS, math.multiply(<span class="hljs-number">-1</span>, YS));
  <span class="hljs-keyword">var</span> ZSS = math.multiply(ZS, ZSC);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>console.time();</p>
<h2 id="complex-coefficients">Complex coefficients</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[0] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>ZC[0] = math.eval(“Z1 <em> Z1 </em> (4 <em> HDDM </em> ZS + Z1 <em> (4 </em> HSDM + 4 <em> HDM </em> ZSS + Z1 <em> \
                   (2 </em> HSM <em> ZSC + ZSS </em> ZSC - Z1 <em> (2 </em> HDM + Z1 * ZS) ) ) )”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Z1 <em> Z1 </em> (4 <em> HDDM </em> ZS + Z1 <em> (4 </em> HSDM + 4 <em> HDM </em> ZSS + Z1 <em> (2 </em> HSM <em> ZSC + ZSS </em> ZSC - Z1 <em> (2 </em> HDM + Z1 * ZS) ) ) )</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p> (2 <em> HDM + Z1 </em> ZS)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_0_paren1 = math.add(math.multiply(<span class="hljs-number">2</span>, HDM), math.multiply(Z1, ZS))</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>(2 <em> HSM </em> ZSC + ZSS <em> ZSC - Z1 </em> (ZC_0_paren1) )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_0_paren2 = math.subtract(math.add(math.multiply(math.multiply(<span class="hljs-number">2</span>, HSM), ZSC), math.multiply(ZSS, ZSC)),
                                  math.multiply(Z1, ZC_0_paren1))</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>(4 <em> HSDM + 4 </em> HDM <em> ZSS + Z1 </em> (ZC_0_paren2) )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_0_paren3 = math.add(math.add(math.multiply(<span class="hljs-number">4</span>, HSDM), math.multiply(<span class="hljs-number">4</span>, math.multiply(HDM, ZSS))),
                             math.multiply(Z1, ZC_0_paren2))</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>4 <em> HDDM </em> ZS + Z1 * (ZC_0_paren3) )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_0_paren4 = math.add(math.multiply(<span class="hljs-number">4</span>, math.multiply(HDDM, ZS)), math.multiply(Z1, ZC_0_paren3))</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Z1 <em> Z1 </em> (ZC_0_paren4)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">0</span>] = math.multiply(Z1, math.multiply(Z1, ZC_0_paren4))</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[1] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>ZC[1] = math.eval(“-Z1 <em> (8 </em> HSDM <em> ZS + Z1 </em> (4 <em> HDDM + 4 </em> HSSM + 4 <em> HSM </em> ZSS + Z1 <em> \
                    (4 </em> HDM <em> ZSC + Z1 </em> (ZSC <em> ZSC - Z1 </em> Z1) ) ) )”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>-Z1 <em> (8 </em> HSDM <em> ZS + Z1 </em> (4 <em> HDDM + 4 </em> HSSM + 4 <em> HSM </em> ZSS + Z1 <em> (4 </em> HDM <em> ZSC + Z1 </em> (ZSC <em> ZSC - Z1 </em> Z1) ) ) )</p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>ZSC <em> ZSC - Z1 </em> Z1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_1_paren1 = math.subtract(math.multiply(ZSC, ZSC), math.multiply(Z1, Z1));</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>4 <em> HDM </em> ZSC + Z1 * (ZC_1_paren1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_1_paren2 = math.add(math.multiply(<span class="hljs-number">4</span>, math.multiply(HDM, ZSC)), math.multiply(Z1, ZC_1_paren1))</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>4 <em> HDDM + 4 </em> HSSM + 4 <em> HSM </em> ZSS + Z1 * (ZC_1_paren2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_1_paren3 = math.add(math.add(math.add(math.multiply(<span class="hljs-number">4</span>, HDDM), math.multiply(<span class="hljs-number">4</span>, HSSM)),
                                      math.multiply(<span class="hljs-number">4</span>, math.multiply(HSM, ZSS))),
                             math.multiply(Z1, ZC_1_paren2));</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>8 <em> HSDM </em> ZS + Z1 * (ZC_1_paren3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_1_paren4 = math.add(math.multiply(<span class="hljs-number">8</span>, math.multiply(HSDM, ZS)),
                             math.multiply(Z1, ZC_1_paren3));</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>-Z1 * (ZC_1_paren4)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">1</span>] = math.multiply(<span class="hljs-number">-1</span>, math.multiply(Z1, ZC_1_paren4));</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[2] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>ZC[2] = math.eval(“4 <em> HSSM </em> ZS + Z1 <em> (4 </em> HSDM - 4 <em> HDM </em> ZSS + Z1 <em> \
                    (-2 </em> ZSS <em> ZSC + Z1 </em> (4 <em> HDM + 2 </em> ZS * Z1 ) ) )”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>4 <em> HSSM </em> ZS + Z1 <em> (4 </em> HSDM - 4 <em> HDM </em> ZSS + Z1 <em> (-2 </em> ZSS <em> ZSC + Z1 </em> (4 <em> HDM + 2 </em> ZS * Z1 ) ) )</p>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>4 <em> HDM + 2 </em> ZS * Z1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_2_paren1 = math.add(math.multiply(<span class="hljs-number">4</span>, HDM),
                             math.multiply(<span class="hljs-number">2</span>, math.multiply(ZS, Z1)));</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>-2 <em> ZSS </em> ZSC + Z1 * (ZC_2_paren1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_2_paren2 = math.add(math.multiply(<span class="hljs-number">-2</span>, math.multiply(ZSS, ZSC)),
                             math.multiply(Z1, ZC_2_paren1));</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p> 4 <em> HSDM - 4 </em> HDM <em> ZSS + Z1 </em> (ZC_2_paren2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_2_paren3 = math.add(math.subtract(math.multiply(<span class="hljs-number">4</span>, HSDM),
                                           math.multiply(<span class="hljs-number">4</span>, math.multiply(HDM, ZSS))),
                             math.multiply(Z1, ZC_2_paren2));</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>4 <em> HSSM </em> ZS + Z1 * (ZC_2_paren3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">2</span>] = math.add(math.multiply(<span class="hljs-number">4</span>, math.multiply(HSSM, ZS)),
                   math.multiply(Z1, ZC_2_paren3));</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[3] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>ZC[3] = math.eval(“4 <em> HSM </em> ZSS + Z1 <em> (4 </em> HDM <em> ZSC + Z1 </em> (2 <em> ZSC </em> ZSC - 2 <em> Z1 </em> Z1) )”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>4 <em> HSM </em> ZSS + Z1 <em> (4 </em> HDM <em> ZSC + Z1 </em> (2 <em> ZSC </em> ZSC - 2 <em> Z1 </em> Z1) )</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>2 <em> ZSC </em> ZSC - 2 <em> Z1 </em> Z1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_3_paren1 = math.subtract(math.multiply(<span class="hljs-number">2</span>, math.multiply(ZSC, ZSC)),
                                  math.multiply(<span class="hljs-number">2</span>, math.multiply(Z1, Z1)))</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>4 <em> HDM </em> ZSC + Z1 * (ZC_3_paren1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_3_paren2 = math.add(math.multiply(<span class="hljs-number">4</span>, math.multiply(HDM, ZSC)),
                             math.multiply(Z1, ZC_3_paren1));</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>4 <em> HSM </em> ZSS + Z1 * (ZC_3_paren2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">3</span>] = math.add(math.multiply(<span class="hljs-number">4</span>, math.multiply(HSM, ZSS)),
                         math.multiply(Z1, ZC_3_paren2));</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[4] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>ZC[4] = math.eval(“ZSC <em> (ZSS -2 </em> HSM) - Z1 <em> (2 </em> HDM + ZS * Z1)”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>ZSC <em> (ZSS -2 </em> HSM) - Z1 <em> (2 </em> HDM + ZS * Z1)</p>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>ZSS -2 * HSM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_4_paren1 = math.subtract(ZSS, math.multiply(<span class="hljs-number">2</span>, HSM));</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>2 <em> HDM + ZS </em> Z1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZC_4_paren2 = math.add(math.multiply(<span class="hljs-number">2</span>, HDM), math.multiply(ZS, Z1));</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>ZSC <em> (ZC_4_paren1) - Z1 </em> (ZC_4_paren2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">4</span>] = math.subtract(math.multiply(ZSC, ZC_4_paren1), math.multiply(Z1, ZC_4_paren2));</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZC[5] *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>ZC[5] = math.eval(“Z1 <em> Z1 - ZSC </em> ZSC”, scope);</p>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Z1 <em> Z1 - ZSC </em> ZSC</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC[<span class="hljs-number">5</span>] = math.subtract(math.multiply(Z1, Z1), math.multiply(ZSC, ZSC));</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  M = <span class="hljs-number">5</span>                     <span class="hljs-comment">// Number of possible solutions</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>ZI = poly.polyroots(ZC)   // Find roots of the polynomial
ZI = new Array(5).fill(0); // DEBUG: temp</p>

            </div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>DEBUG: temp test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> ZC_real = [];
  <span class="hljs-keyword">var</span> ZC_imag = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> ZC) {
    ZC_real.push(math.complex(ZC[i]).re);
    ZC_imag.push(math.complex(ZC[i]).im);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>console.time();
var ZC_roots = findRoots(ZC_real, ZC_imag);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ZC_real_reverse = ZC_real.slice().reverse();
  ZC_imag_reverse = ZC_imag.slice().reverse();
  <span class="hljs-keyword">var</span> ZC_roots = cpoly(ZC_real_reverse, ZC_imag_reverse);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>console.timeEnd();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> ZI = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;ZC_roots[<span class="hljs-number">0</span>].length; i++) {
    <span class="hljs-keyword">if</span> (almostEquals(<span class="hljs-number">0</span>, ZC_roots[<span class="hljs-number">0</span>][i]) === <span class="hljs-literal">true</span>)
      ZC_roots[<span class="hljs-number">0</span>][i] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (almostEquals(<span class="hljs-number">0</span>, ZC_roots[<span class="hljs-number">1</span>][i]) === <span class="hljs-literal">true</span>)
      ZC_roots[<span class="hljs-number">1</span>][i] = <span class="hljs-number">0</span>;

    ZI.push(math.complex(ZC_roots[<span class="hljs-number">0</span>][i], ZC_roots[<span class="hljs-number">1</span>][i]));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>ZI = [ math.complex(-1.11803399e+00, -8.26372302e-20),
math.complex(-1.38344197e-16, 8.66025404e-01),
math.complex(0.00000000e+00, 0.00000000e+00),
math.complex(8.12052344e-17, -8.66025404e-01),
math.complex(1.11803399e+00, -2.22044605e-16)]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> SA = <span class="hljs-number">0.0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>result = [[0, 0, 0, 0],
[0, 0, 0, 0],
[0, 0, 0, 0],
[0, 0, 0, 0],
[0, 0, 0, 0]];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

  resultColumns = [];

  <span class="hljs-keyword">var</span> XI = math.re(ZI);
  resultColumns.push(XI); <span class="hljs-comment">// result_0</span>
  <span class="hljs-keyword">var</span> YI = math.im(ZI);
  resultColumns.push(YI); <span class="hljs-comment">// result_1</span>

  <span class="hljs-keyword">var</span> ZR = ZI;</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/******* Caclulating ZP *********/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>WARNING: THIS MAY NOT BE REQUIRED? DELETE FOR SPEED IF SO
return {ZR: ZR, ZC: ZC};
mathjs eval syntax has one-based numbering, so array indicies increment by one
ZP = math.eval(“ZC[0+1] + ZR <em> (ZC[1+1] + ZR </em> (ZC[2+1] + ZR <em> (ZC[3+1] + \
                                ZR </em> (ZC[4+1] + ZR * ZC[5+1]) ) ) )”, {ZR: math.matrix(ZR),
                                                                                       ZC: math.matrix(ZC)}).toArray();</p>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>ZC[0+1] + ZR <em> (ZC[1+1] + ZR </em> (ZC[2+1] + ZR <em> (ZC[3+1] + ZR </em> (ZC[4+1] + ZR * ZC[5+1]) ) ) )</p>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>ZC[4+1] + ZR * ZC[5+1]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-comment">/*

  var ZP_paren1 = math.add(ZC[4], math.multiply(ZR, ZC[5]));

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>ZC[3+1] + ZR * (ZR_paren1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZP_paren2 = math.add(ZC[<span class="hljs-number">3</span>], math.multiply(ZR, ZP_paren1));</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>ZC[2+1] + ZR * (ZR_paren2)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZP_paren3 = math.add(ZC[<span class="hljs-number">2</span>], math.multiply(ZR, ZP_paren2));</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>ZC[1+1] + ZR * (ZR_paren3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZP_paren4 = math.add(ZC[<span class="hljs-number">1</span>], math.multiply(ZR, ZP_paren3));</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>ZC[0+1] + ZR * (ZR_paren4)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  var ZP = math.add(ZC[0], math.multiply(ZR, ZP_paren4));

  */</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <hr>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ZIC = math.conj(ZI);

  <span class="hljs-keyword">var</span> ZDC1 = math.subtract(ZIC, Z1C);

  <span class="hljs-keyword">var</span> ZDC2 = math.subtract(ZIC, Z2C);

  <span class="hljs-keyword">var</span> ZB_term1 = math.multiply(GM1, math.dotPow(ZDC1, <span class="hljs-number">-1</span>)); <span class="hljs-comment">// GM1/ZDC1</span>
  <span class="hljs-keyword">var</span> ZB_term2 = math.multiply(GM2, math.dotPow(ZDC2, <span class="hljs-number">-1</span>)); <span class="hljs-comment">// GM2/ZDC2</span>
  <span class="hljs-keyword">var</span> ZB = math.add(ZB_term1, ZB_term2); <span class="hljs-comment">// GM1/ZDC1 + GM2/ZDC2</span>

  <span class="hljs-keyword">var</span> ZE = math.subtract(ZI, ZB)
  <span class="hljs-keyword">var</span> AE = math.abs(ZE);
  <span class="hljs-keyword">var</span> ZD_term1 = math.multiply(GM1, math.dotPow(ZDC1, <span class="hljs-number">-2</span>)); <span class="hljs-comment">// GM1/(ZDC1*ZDC1)</span>
  <span class="hljs-keyword">var</span> ZD_term2 = math.multiply(GM2, math.dotPow(ZDC2, <span class="hljs-number">-2</span>)); <span class="hljs-comment">// GM2/(ZDC2*ZDC2)</span>
  <span class="hljs-keyword">var</span> ZD = math.add(ZD_term1, ZD_term2); <span class="hljs-comment">// GM1/(ZDC1*ZDC1) + GM2/(ZDC2*ZDC2)</span>

  <span class="hljs-keyword">var</span> CJ = math.abs(math.dotPow(ZD, <span class="hljs-number">2</span>)); <span class="hljs-comment">// abs(ZD*ZD)</span>
  <span class="hljs-keyword">var</span> VJ = math.subtract(<span class="hljs-number">1</span>, CJ);
  <span class="hljs-keyword">var</span> AJ = math.dotPow(VJ, <span class="hljs-number">-1</span>); <span class="hljs-comment">// 1/VJ</span>
  <span class="hljs-keyword">var</span> AI = AJ;
  resultColumns.push(AI); <span class="hljs-comment">// result_2</span>
  SA = math.add(SA, AJ);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;M; i++) {

    <span class="hljs-keyword">var</span> firstComparison = compareComplexNumToZero(AJ[i]);
    <span class="hljs-keyword">var</span> secondComparison = compareComplexNumToZero(math.subtract(math.abs(math.subtract(ZE[i], ZS)), EP));</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>console.log(<code>first comparison: ${firstComparison}</code>);
console.log(<code>second comparison: ${secondComparison}</code>);
case #1
if (AJ[I] &lt; 0 and not np.abs(ZE[I] - ZS) - EP &gt; 0):</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (firstComparison === <span class="hljs-number">-1</span> &amp;&amp; secondComparison &lt; <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>console.log(“adding -1 to IP”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      IP[i] = <span class="hljs-number">-1</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>case #2
if (AJ[I] == 0 and np.abs(ZE[I] - ZS) - EP &gt; 0):</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (firstComparison === <span class="hljs-number">0</span> &amp;&amp; secondComparison === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>console.log(“adding 0 to IP”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      IP[i] = <span class="hljs-number">0</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>case #3
if (AJ[I] &gt; 0 and not np.abs(ZE[I] - ZS) - EP &gt; 0):</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (firstComparison === <span class="hljs-number">1</span> &amp;&amp; secondComparison &lt; <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>console.log(“adding +1 to IP”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      IP[i] = <span class="hljs-number">1</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>IP = math.complex(IP); // DEBUG: temp? maybe not needed or not best way?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  resultColumns.push(IP); <span class="hljs-comment">// result_3</span>

  results = math.transpose(resultColumns);

  <span class="hljs-keyword">if</span> (timeDebug === <span class="hljs-literal">true</span>)
    <span class="hljs-built_in">console</span>.timeEnd();</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>return scope; // DEBUG: temp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">almostEquals</span>(<span class="hljs-params">a, b, epsilon=<span class="hljs-number">1e-12</span></span>) </span>{
  <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Math</span>.abs(a - b) &lt; epsilon);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareComplexNumToZero</span>(<span class="hljs-params">num</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>if num “almost equals” 0: returns 0
else if num &gt; 0: returns 1
else if num &lt; 0: returns -1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> complexNum = math.complex(num);</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>if real component is ~=0, use only imaginary component for comparison –
if real component is nonzero, use only the real component for comparison</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (almostEquals(complexNum.re, <span class="hljs-number">0</span>) === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">var</span> comparisonNum = complexNum.im;
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> comparisonNum = complexNum.re;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>console.log(<code>comparisonNum is: ${comparisonNum}</code>);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> (almostEquals(comparisonNum, <span class="hljs-number">0</span>) === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comparisonNum &gt; <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comparisonNum &lt; <span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
 <span class="hljs-keyword">else</span>
   <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ERROR: comparisonNum is: <span class="hljs-subst">${comparisonNum}</span>`</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>var scope = bin_ima(); // debug</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">bin_ima</span>: bin_ima,</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>scope: scope, // debug</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  almostEquals: almostEquals,
  <span class="hljs-attr">compareComplexNumToZero</span>: compareComplexNumToZero,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
